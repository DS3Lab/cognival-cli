import filecmp
import json
import sys

from functools import partial
from pathlib import Path

import numpy as np
import pytest
import pandas as pd
import tensorflow as tf

sys.path.insert(0, '..')

from handlers.data_handler import *
from handlers.model_handler import *
	
from numpy.random import seed

@pytest.fixture
def set_seed():
    seed(42)
    tf.random.set_seed(42) 

@pytest.fixture
def reference_model_config():
    return {'name': 'sequential',
            'layers': [{'class_name': 'Dense',
            'config': {'name': 'dense',
                'trainable': True,
                'batch_input_shape': (None, 30),
                'dtype': 'float32',
                'units': 100,
                'activation': 'relu',
                'use_bias': True,
                'kernel_initializer': {'class_name': 'GlorotUniform',
                'config': {'seed': None}},
                'bias_initializer': {'class_name': 'Zeros', 'config': {}},
                'kernel_regularizer': None,
                'bias_regularizer': None,
                'activity_regularizer': None,
                'kernel_constraint': None,
                'bias_constraint': None}},
            {'class_name': 'Dense',
            'config': {'name': 'dense_1',
                'trainable': True,
                'dtype': 'float32',
                'units': 50,
                'activation': 'relu',
                'use_bias': True,
                'kernel_initializer': {'class_name': 'GlorotUniform',
                'config': {'seed': None}},
                'bias_initializer': {'class_name': 'Zeros', 'config': {}},
                'kernel_regularizer': None,
                'bias_regularizer': None,
                'activity_regularizer': None,
                'kernel_constraint': None,
                'bias_constraint': None}},
            {'class_name': 'Dense',
            'config': {'name': 'dense_2',
                'trainable': True,
                'dtype': 'float32',
                'units': 15,
                'activation': 'linear',
                'use_bias': True,
                'kernel_initializer': {'class_name': 'GlorotUniform',
                'config': {'seed': None}},
                'bias_initializer': {'class_name': 'Zeros', 'config': {}},
                'kernel_regularizer': None,
                'bias_regularizer': None,
                'activity_regularizer': None,
                'kernel_constraint': None,
                'bias_constraint': None}}]}


@pytest.fixture
def config():
    return {
    "PATH": "/home/adrian/repos/cognival/tests/",
    "cogDataConfig": {
        "zuco-eeg": {
            "dataset": "cognitive-data/eeg/zuco/zuco_scaled.txt",
            "features": [
                "ALL_DIM"
            ],
            "type": "multivariate_output",
            "wordEmbSpecifics": {
                "glove-50": {
                    "activations": [
                        "relu"
                    ],
                    "batch_size": [
                        128
                    ],
                    "cv_split": 3,
                    "epochs": [
                        100
                    ],
                    "layers": [
                        [
                            26
                        ],
                        [
                            30
                        ],
                        [
                            20
                        ],
                        [
                            5
                        ]
                    ],
                    "validation_split": 0.2
                }
            }
        }
    },
    "cpu_count": 40,
    "folds": 5,
    "outputDir": "zuco-feature-wordEmbedding",
    "seed": 123,
    "version": 11.0,
    "wordEmbConfig": {
        "glove-50": {
            "chunk_number": 4,
            "chunked": 1,
            "chunked_file": "reference/chunked_embeddings/glove-50_",
            "ending": ".txt",
            "path": "input/glove.6B.50d.txt"
        }
    }
}

@pytest.fixture
def config_embedding(config):
    return config['cogDataConfig']['zuco-eeg']['wordEmbSpecifics']['glove-50']


@pytest.fixture
def data(config):
    words_test, X_train, y_train, X_test, y_test = data_handler(config,
                                                               'glove-50',
                                                               'zuco-eeg',
                                                               'ALL_DIM')
    return words_test, X_train, y_train, X_test, y_test


@pytest.fixture
def grid_search_reference():
    grid_reduced = {'cv': 3,
                    'error_score': 'raise-deprecating',
                    'estimator__verbose': 0,
                    'iid': 'warn',
                    'n_jobs': None,
                    'param_grid': {'layers': [[26], [30], [20], [5]],
                                    'activation': ['relu'],
                                    'input_dim': [50],
                                    'output_dim': [105],
                                    'batch_size': [128],
                                    'epochs': [100]},
                    'pre_dispatch': '2*n_jobs',
                    'refit': True,
                    'return_train_score': False,
                    'scoring': 'neg_mean_squared_error',
                    'verbose': 0}

    
    best_params = {'activation': 'relu', 'batch_size': 128, 'epochs': 100, 'input_dim': 50, 'layers': [5], 'output_dim': 105}

    return grid_reduced, best_params

@pytest.fixture
def predict_result():
    mse = np.array([8.53530761e-03, 5.52366162e-03, 5.23570459e-03, 6.81725270e-03,
                    1.20838584e-02, 5.59006703e-03, 8.69471472e-03, 8.02265970e-03,
                    1.01880209e-02, 1.30123375e-02, 9.49348266e-03, 4.98414239e-03,
                    9.56078619e-03, 7.53012103e-03, 1.16130592e-02, 1.36139184e-02,
                    7.92248509e-03, 1.26902429e-02, 1.23764636e-02, 7.74921346e-03,
                    1.01408477e-02, 1.02416182e-02, 9.81694164e-03, 5.95738992e-03,
                    3.92210530e-03, 1.13988782e-02, 1.45595241e-02, 8.94526114e-03,
                    8.79460143e-03, 6.31037933e-03, 1.76510598e-03, 1.24181097e-02,
                    1.29653257e-02, 1.14282262e-02, 9.32371792e-03, 6.03054345e-03,
                    9.95352511e-03, 1.06297305e-02, 9.50965020e-03, 9.71354275e-03,
                    1.09333500e-02, 1.10687963e-02, 1.00123444e-02, 9.99808528e-03,
                    7.99865784e-03, 6.15380429e-03, 9.43263036e-03, 1.17564786e-02,
                    1.13191883e-02, 8.68737694e-03, 9.07147578e-03, 1.14123178e-02,
                    1.09833061e-02, 1.12051527e-02, 1.09942020e-02, 1.17983907e-02,
                    7.10804924e-03, 7.98434975e-03, 1.20925244e-02, 1.21469846e-02,
                    6.27457926e-03, 7.61465277e-03, 1.14772282e-02, 1.39942134e-02,
                    7.79810811e-03, 6.72074395e-03, 3.79137598e-03, 5.44733626e-03,
                    8.74334943e-03, 9.57375835e-03, 1.54465187e-02, 1.21792397e-02,
                    6.42688243e-03, 6.64559822e-03, 8.04103102e-03, 1.14239177e-02,
                    1.33927705e-02, 1.13854958e-02, 6.38230004e-03, 7.42505317e-03,
                    1.16771679e-02, 1.03635018e-02, 7.36405932e-03, 9.64281411e-03,
                    7.78246227e-03, 8.10015120e-03, 8.42726903e-03, 7.11722857e-03,
                    5.43786022e-03, 9.57562778e-03, 6.82832332e-03, 6.91979182e-03,
                    6.89818956e-03, 9.23771705e-03, 4.91365766e-03, 1.06385703e-02,
                    7.06425888e-03, 7.27167838e-03, 5.24602258e-03, 4.40441234e-03,
                    9.74402806e-03, 6.30617333e-03, 6.20594901e-03, 6.36752639e-03,
                    4.92986299e-09])

    w_e = np.array([['penfield', '-0.09071308332187994', '-0.1742187379269803',
                    '-0.1697919059371063', '-0.15486583906279733',
                    '-0.044099908228420026', '0.004824511153160127',
                    '-0.19281059311425464', '-0.12820541852626793',
                    '-0.18580577253495717', '-0.06215853254151421',
                    '0.07962101080622941', '-0.12936219234319235',
                    '-0.15437628370146977', '-0.08732591427114089',
                    '-0.019790848904643', '0.015419114983360238',
                    '-0.006121382914833884', '0.017767600205118028',
                    '0.0374952717089545', '-0.023503795584280562',
                    '0.07709411958414647', '-0.022917867273534065',
                    '0.017068457421854477', '0.02096018867492977',
                    '0.051071056299319295', '0.013505817293024025',
                    '-0.010973103657290206', '0.06714553923033517',
                    '0.05308490394439891', '0.021582129414234985',
                    '-0.04496641072969221', '-0.02277478362809998',
                    '0.06376448895650733', '-0.0004941854199528306',
                    '0.002769203689215516', '-0.004979026357853411',
                    '-0.19792634772690587', '0.02037122526623736',
                    '0.0618198174397564', '-0.008237783912871888',
                    '0.03608934067680625', '0.0016720205632649865',
                    '0.03647408138539421', '-0.03545346804102173',
                    '0.03641217382973527', '0.04694225417878256',
                    '-0.045785371870173064', '-0.01948847902094042',
                    '0.0024064024817094243', '-0.01983020475796482',
                    '0.04998020917211732', '0.09541728432789165',
                    '-0.03914667991427634', '-0.056838464388546284',
                    '0.020822833680493535', '0.028116483365831613',
                    '-0.01712993066497237', '0.004754300571785386',
                    '0.034411755699418234', '0.040718089109900935',
                    '-0.01180438733582967', '0.004826945276715178',
                    '0.024080147628103288', '0.07740081174417868',
                    '-0.01490303361072337', '0.05950018112553612',
                    '-0.014700693265392528', '-0.016598960989968048',
                    '-0.00554027287924691', '0.021026545870765523',
                    '0.0005210133658646865', '-0.04263174236745526',
                    '-0.037227286570215956', '-0.015993412121008355',
                    '0.02768945957810337', '-0.016398027763565803',
                    '-0.07259605167003463', '-0.13154530480230514',
                    '0.01852073617183697', '0.018114842606903603',
                    '-0.06345166216465092', '-0.10256109934860241',
                    '-0.0075819716727923425', '-0.06679507629263348',
                    '-0.014262230619492555', '-0.10543620292791103',
                    '-0.12585591461672846', '-0.1045577364885995',
                    '-0.1493628573915306', '-0.11029525131966472',
                    '-0.06105056285766075', '-0.12931619677149142',
                    '-0.09910640223834666', '-0.17353485663486226',
                    '0.08913863456297133', '-0.032411767490724386',
                    '-0.09777479530122996', '-0.17085900962870448',
                    '-0.21348523506327216', '0.08174332667070261',
                    '0.1452738736307333', '-0.09556841983349423',
                    '-0.20495230085568716', '-0.21233050652465152',
                    '-4.4575310312211514e-05'],
                ['raised', '0.01172595952226485', '-0.04411562001455105',
                    '-0.03406823212562021', '-0.05780844473838692',
                    '-0.047407339648040725', '-0.030005324843528858',
                    '-0.008683861520668024', '-0.03584617177361221',
                    '-0.05739710748812055', '-0.009510787691056954',
                    '-0.0008987473691564052', '-0.034555495446614515',
                    '-0.07416303543314001', '-0.11526413607885011',
                    '-0.024630381978409277', '0.006253196822692875',
                    '-0.1061973594280235', '-0.10368267347787402',
                    '0.03587231830649962', '-0.015432132361856699',
                    '0.014027655867117184', '0.006134306371257392',
                    '0.038786783038254447', '0.013897756931532279',
                    '0.01976320731870651', '0.018576588136531624',
                    '0.07735027218037538', '0.042731408474394716',
                    '0.05600884047881094', '0.028013122656565526',
                    '0.003783065097418714', '0.04283618636856468',
                    '0.06556489018202794', '0.05503868580773008',
                    '0.08225536411621659', '0.07132311780858869',
                    '0.09165449614854593', '0.06200531515968155',
                    '0.04451558357355134', '0.056850003684756456',
                    '0.046922719568155635', '0.01969025427180482',
                    '0.04782747102986529', '0.0876363967400895',
                    '0.09316133381056535', '0.05821425138558167',
                    '0.010561118181331652', '0.013386823065780984',
                    '0.02881632284050728', '0.06245851534951752',
                    '0.04776557038427076', '0.053026564653337216',
                    '0.010820681037235103', '0.016899326734022613',
                    '0.033913113309105625', '0.03936877491658042',
                    '0.013125005121570554', '0.024158362810528522',
                    '0.02663098543884357', '0.05047511836209673',
                    '0.02106262672839393', '0.01531559622592571',
                    '0.04324834563515789', '0.08996330384507278',
                    '0.07857712572275166', '0.07059691759398112',
                    '0.003917968155970675', '0.019416433521853738',
                    '0.04234211557950973', '0.07247068386368316',
                    '0.09202502252784761', '0.07076412509449137',
                    '0.007062744153410683', '0.05176456691037823',
                    '0.07014001667837366', '0.06283881571547711',
                    '0.06131663133729037', '0.00613825319039607',
                    '0.03276309843252789', '0.04036248290048561',
                    '0.041192201351086366', '0.03421584505465364',
                    '0.04731574680503703', '0.030415036289009545',
                    '0.015605817792886056', '0.010523255654472652',
                    '-0.028880624096232876', '-0.03762823525080172',
                    '-0.07473835960788655', '0.036950280916352884',
                    '-0.007393218227426002', '-0.02558663007929618',
                    '-0.032226956646446425', '-0.07252371156552773',
                    '0.08135198336534588', '0.0674336989271862',
                    '-0.01744832683741332', '-0.027010967775601302',
                    '-0.030370095932643393', '0.06259184987242827',
                    '0.0824523245034724', '0.0483208085992885',
                    '-0.033426005798028346', '-0.021090928798238262',
                    '-1.2069358490407467e-05'],
                ['described', '-0.22415469468715277', '-0.12839579923990146',
                    '-0.11216995117492523', '-0.1829820286857135',
                    '-0.1804173745182695', '-0.11110528865520974',
                    '-0.12223746723942436', '-0.2097759398965011',
                    '-0.18950235680718447', '-0.16768820427639558',
                    '-0.05010347282277533', '-0.03684003487740217',
                    '-0.16550620612513217', '-0.16547141555270972',
                    '-0.12913945168386576', '-0.1795401848964458',
                    '-0.045864071052800326', '-0.14238990034671672',
                    '-0.17175248671491478', '-0.0832750200210306',
                    '-0.13994651204891922', '-0.12559873405577832',
                    '-0.09274065493633138', '0.03282431644714934',
                    '0.055068645798564075', '-0.11120969536098407',
                    '-0.1339687274407852', '-0.02355516114120082',
                    '0.027462382695123577', '0.13163369995282215',
                    '-0.06368677095557157', '-0.11385378329614332',
                    '-0.017948884512956398', '-0.050893911987711316',
                    '0.05771510445188632', '-0.1347970891164736',
                    '-0.12174406450818093', '-0.08878617112854348',
                    '0.010256075069040582', '0.022979164048922085',
                    '0.026958353462584017', '0.01809889681292909',
                    '0.11791268394829446', '0.13022528522732424',
                    '0.12425574976019194', '0.07182397935858886',
                    '-0.06471801468365251', '0.02689855913112782',
                    '0.0673598538405682', '0.0809766416505967',
                    '0.16727284077944604', '0.23066385092786434',
                    '0.007743330782858715', '0.055840649197167136',
                    '0.10213027808408692', '0.20434363502325725',
                    '0.05174522973212592', '0.11150928108860347',
                    '0.1834900120854699', '0.1913740482504187',
                    '0.06563232671477315', '0.13730346650502467',
                    '0.1498371581472847', '0.14553592127747927',
                    '0.10373122088153464', '0.02598180335669298',
                    '-0.08260838660101066', '0.08286279520215456',
                    '0.0774370228749437', '0.059103936991555805',
                    '0.10964179880593972', '-0.006494937452205751',
                    '-0.11167635202628651', '0.03774256432181555',
                    '0.03253792187996185', '0.021227280455008102',
                    '-0.006068254433901854', '-0.07167654212571023',
                    '-0.013904879716766128', '-0.021518735047008464',
                    '-0.04251288140644349', '-0.08423059032181512',
                    '-0.029727704651176023', '0.013835479441958287',
                    '-0.07193339201917509', '-0.10246041465337402',
                    '-0.1623032722018397', '-0.1601338451394434',
                    '-0.1871681905039219', '-0.10313684296948006',
                    '-0.11328249748680574', '-0.1546149848232889',
                    '-0.16494977121228105', '-0.3337787507667897',
                    '-0.06826192435970513', '-0.1598990980317877',
                    '-0.16603826206239475', '-0.19743488194760195',
                    '-0.19877036362613953', '-0.0728153258769168',
                    '-0.15496995494032462', '-0.14878404022199906',
                    '-0.14432742347161304', '-0.17361197817690127',
                    '5.465070717036724e-05'],
                ['treasury', '-0.1038457153944582', '-0.042591362153321544',
                    '-0.0633564420366487', '-0.11142092142227111',
                    '-0.19091233433910226', '-0.1069885148370926',
                    '-0.033024624177210915', '-0.07732327289152363',
                    '-0.15010291313256224', '-0.20775556900220193',
                    '-0.21845278383887728', '0.0051883590860762885',
                    '-0.12954030225189256', '-0.10751688239369878',
                    '-0.186611621710973', '-0.22736806719080588',
                    '-0.1079196868457667', '-0.21047747061544186',
                    '-0.16105947528345782', '-0.10429157945714679',
                    '-0.15766544879363353', '-0.1812753243678974',
                    '-0.06671919862691056', '-0.023270897995891215',
                    '-0.017135225712664126', '-0.09409949518155813',
                    '-0.12734249891639304', '-0.03675617614320592',
                    '0.05206647838931577', '-0.013182270346813518',
                    '-0.07879820139830848', '-0.06706435063365362',
                    '-0.027020958979695142', '-0.014542021679091854',
                    '0.06326269101376336', '-0.011923044585095577',
                    '0.024997194881748563', '0.01717035489436769',
                    '0.01902338387732383', '-0.01666558490992881',
                    '0.014313874349310862', '0.0854931448960291',
                    '0.04311655318743346', '0.03420038827462768',
                    '0.08521874759442383', '0.027040554394918148',
                    '0.10157776825900644', '0.04090013117016378',
                    '0.025599486277707695', '0.07615842815094143',
                    '0.06864412232291095', '0.05458121747764488',
                    '0.09074786507284716', '0.0777453559346043',
                    '0.07135975640291259', '0.04708949026359599',
                    '0.06297603022178955', '0.06192239162332147',
                    '0.06766150434374041', '0.08527714562177735',
                    '0.030830561305059845', '0.041446216772678346',
                    '0.06504557639153485', '0.035268589199799805',
                    '0.0290942530390349', '0.026350536230570154',
                    '0.06749147954868451', '0.05476461365505436',
                    '0.06429246650716935', '0.06867062887419517',
                    '0.04863560538581424', '0.01957291107072423',
                    '0.015571002195239325', '0.036173348160485286',
                    '0.05320969820621302', '0.07955341059554721',
                    '0.08575498302948803', '0.05021836832018722',
                    '0.03190796394526063', '0.07736432497159995',
                    '0.09460924521786085', '0.08597956424305087',
                    '0.08719816935741265', '0.09766575432130231',
                    '0.09511335305712232', '0.01587712391625079',
                    '0.00038411197185839185', '0.015547426179128576',
                    '-0.0752546279987083', '0.11062570979217456',
                    '0.03303891556310368', '-0.03594290897245184',
                    '-0.05335428609615456', '-0.1366766093298381',
                    '-0.04588714296505064', '0.023289786573566063',
                    '-0.03438159437925686', '-0.0664326252232646',
                    '-0.07627961561839625', '-0.012504992819649341',
                    '-0.21692057095459494', '-0.014313887544286474',
                    '-0.04772905667552796', '-0.03629453706957314',
                    '-4.2555853724479675e-05'],
                ['cabinet', '0.08037333856218987', '0.07453285418870736',
                    '0.10145131214814818', '0.1430020660232515',
                    '0.05175597140418442', '0.08040314958395622',
                    '0.05010526153188255', '0.17386844814252556',
                    '0.14999560794030609', '0.03399760764040327',
                    '-0.043988364632622456', '0.1306593700504367',
                    '0.11521227698122705', '0.2189009258091612',
                    '0.06498403830202326', '0.06502807851944492',
                    '0.21926766786369545', '0.14105675892273217',
                    '0.06484345211887166', '0.11597014148400264',
                    '0.1410323246099987', '0.07625158076958038',
                    '0.048369191834422565', '0.047699356354473976',
                    '-0.051753019305780745', '0.15141914475313745',
                    '0.12519545749228533', '0.0768291352877094',
                    '-0.0003274215105515399', '-0.04036701784374275',
                    '0.062079127492182584', '0.09944095527152408',
                    '0.10020907314771277', '0.030204801191421105',
                    '-0.0007257277770628123', '0.21391337653239062',
                    '0.2998667603609144', '0.1092033342176002',
                    '0.035881858310000236', '0.021720221557926078',
                    '0.10011779669386656', '0.10236524560188165',
                    '-0.007346659666643607', '-0.015382301908186347',
                    '-0.06115992187932806', '-0.08690342969591969',
                    '0.20597688922003843', '0.09832660445443586',
                    '0.05041837245402947', '0.002418859595566092',
                    '-0.02812387093203217', '0.010336603667123967',
                    '0.16498220041738476', '0.13047970353930638',
                    '0.06263797407293792', '0.047389896445858226',
                    '0.0883606842598279', '0.095749810623732', '0.08795568416374',
                    '0.010203775537079518', '0.08784331142539292',
                    '0.09140341824637699', '0.05153389884291659',
                    '-0.02616319469527767', '-0.03723611226184054',
                    '-0.0572613910192179', '-0.018801129116591875',
                    '0.08432755838081663', '0.09477632131382585',
                    '0.07617146431682809', '0.012458206683029327',
                    '-0.1381693999598404', '-0.059138309667982',
                    '0.07453070350166069', '0.05610325183694442',
                    '0.03150373756438529', '-0.04466583881563646',
                    '-0.087718735792778', '0.039312725679232496',
                    '0.03080410481278284', '-0.045672217676734184',
                    '-0.07458125030723045', '0.016121274726155488',
                    '-0.024606782098281543', '-0.007511546576020156',
                    '-0.08295437919385534', '-0.05447805846984799',
                    '0.00853607897112435', '0.05207390476672902',
                    '-0.02750818419985751', '-0.05990051840910954',
                    '-0.05375016770655988', '-0.02703200305042669',
                    '0.08703755544831626', '0.025737390181353126',
                    '-0.01452211568849604', '-0.01780553518794914',
                    '0.022878088962311027', '0.08124893988441184',
                    '0.09410243674873886', '0.046522633084327025',
                    '0.01977995363408347', '0.027939270599574018',
                    '0.08558667337075243', '-4.275515675544739e-05'],
                ['boston-based', '-0.04833005048019867', '-0.05718733553993316',
                    '-0.0407493497112969', '-0.02597565463129886',
                    '-0.06872693817380293', '-0.0702792257821',
                    '-0.07247680103592952', '-0.003748952518422499',
                    '0.025562010091665144', '0.018685352311669012',
                    '-0.09348221823269975', '0.015411949207506326',
                    '-0.0007478434801666545', '-0.027028208575691326',
                    '0.013477969894745256', '0.028795490920013656',
                    '-0.02528586691795942', '0.000490750304549814',
                    '-0.022389610549687133', '-0.01668839482331186',
                    '0.015581553139283444', '0.05868187049289586',
                    '0.0399483512569524', '0.02300146997298369',
                    '0.01965585872819997', '-0.0025800249052955193',
                    '0.04861193203842562', '0.01845409629432615',
                    '0.016566566262737004', '0.044367483778451344',
                    '0.021488986747147054', '0.03232231525834062',
                    '0.05107234117474557', '-0.0056180240877193866',
                    '0.006029333181056751', '0.06375774453117977',
                    '0.004083334674063632', '0.03477665581066525',
                    '0.03365986868456661', '0.052971088345037276',
                    '0.04165856685760283', '0.05662102628655663',
                    '0.04003655009867324', '0.009311403488249659',
                    '0.04155501472447232', '0.03852316224433566',
                    '0.01322152811006716', '0.07831170640054219',
                    '0.09479114481998008', '0.0583406910230162',
                    '0.04206975979796379', '0.03124881770954624',
                    '0.052078399925253205', '0.0670691712565783',
                    '0.08244608626608663', '0.021366216992392384',
                    '0.024969324817660954', '0.052428717450791806',
                    '0.030561330465391556', '0.009414358773048415',
                    '0.03603240378572159', '0.04724108382984715',
                    '0.020903187031246717', '0.01726111875818559',
                    '0.007663061081217282', '0.03156174333896977',
                    '0.03182375514485841', '0.03167557909094121',
                    '0.04662798300425286', '0.0020675732490954',
                    '-0.000535599518022345', '0.013052859759990376',
                    '0.014647942970085537', '0.04082744261457383',
                    '0.05522297842404411', '0.04631461930641856',
                    '0.019579915538797732', '0.017417255509468432',
                    '0.04414933484093819', '0.04017174663888412',
                    '0.041582739156945436', '0.002012452306102641',
                    '0.03707370816668004', '0.04120493656635488',
                    '0.01256603855567362', '0.0018329490024645567',
                    '-0.0050496687500964366', '-0.015251896397263376',
                    '-0.02396422872682802', '0.01187229233940329',
                    '-2.3431454352906833e-05', '0.01148102471014345',
                    '-0.014979477925750162', '-0.08013071305348202',
                    '0.044232353744790176', '0.013709918758940787',
                    '-0.018384680015569532', '-0.040974809688737734',
                    '-0.02077787308879897', '0.04489759812810734',
                    '-0.014653167278816492', '-0.000757720053758959',
                    '-0.06033230943985873', '-0.05306630557127062',
                    '7.127644494175911e-06'],
                ['norwich', '0.024389405264146125', '0.009979335401536393',
                    '0.003397843708336512', '0.04001679430982541',
                    '-0.04817025021441823', '-0.0774248754477756',
                    '-0.04255574922158467', '-0.018633268870445252',
                    '-0.009605496862390872', '-0.05500141418563742',
                    '-0.0665021159740628', '0.008136489635196753',
                    '0.00956758849825512', '0.020524789620591233',
                    '-0.014489762872473722', '-0.044155863919492944',
                    '0.08446357998701937', '0.08287751502637553',
                    '0.03460726265381575', '0.04894737788074138',
                    '0.1470985830077961', '0.022350009494766288',
                    '0.025496464619139236', '-0.005105482990755306',
                    '-0.05075122482445671', '0.059010390019071046',
                    '0.019650786767636763', '-0.00651129077071011',
                    '0.007563743624193875', '-0.019045486034875547',
                    '0.014708262790239846', '0.04238999748132166',
                    '0.020001575185229492', '0.018068934725977703',
                    '0.0017068540166229607', '0.025695496165583864',
                    '0.06191665373122679', '0.04882850736854871',
                    '0.03341654676729355', '-0.015400556578920921',
                    '0.0015831354254164376', '0.01372896077431951',
                    '-0.0016956726376801123', '-0.04322641877090011',
                    '-0.0693841274567572', '-0.016710933481644874',
                    '0.0023869479575839847', '0.0005814739165165284',
                    '-0.009766486699733679', '-0.020812709001326812',
                    '-0.03494400320463986', '-0.08401541951936697',
                    '0.014925553683199921', '-0.025541868861242434',
                    '-0.03895780711498642', '-0.03779020229456442',
                    '0.001399876788606369', '-0.03323247799826945',
                    '-0.0642554137463156', '-0.11126206232309854',
                    '-0.026164556775516212', '-0.04741253755819602',
                    '-0.07514985731380536', '-0.11426157272089743',
                    '-0.05698507894598859', '-0.00018172365349133912',
                    '0.036384689390487', '-0.03263706679268036',
                    '-0.04480855661482541', '-0.06110790155467932',
                    '-0.037148615988460254', '0.004762458420812021',
                    '0.03235435035360851', '-0.03495049648029813',
                    '-0.022617549100119372', '0.019765373738831804',
                    '0.051629740351221254', '0.06090533348931082',
                    '0.014164092288280639', '0.0304810503657732',
                    '0.06831203979478795', '0.06219566309705782',
                    '0.013791990380115138', '0.06477602076336114',
                    '0.07900925055269148', '0.050956950800894185',
                    '0.03733006543206513', '0.02476396289734273',
                    '0.03944535144950412', '0.09121872720105995',
                    '0.06338050144603524', '0.012484906800903861',
                    '-0.012423831354640924', '0.031086913032509655',
                    '0.01689250701432965', '0.052353985635467004',
                    '0.03435930409196669', '0.012561827925920088',
                    '0.041256213463722546', '0.03154887409105145',
                    '0.07776691135721192', '0.033270096305611396',
                    '-0.006732048052237427', '-0.0005285227540899884',
                    '3.485765773802996e-05'],
                ['plotted', '-0.06865170346424132', '-0.03131066459184173',
                    '-0.13296460228546264', '-0.09724250037677679',
                    '-0.08777620898984495', '0.00978063926140843',
                    '-0.14776814904009322', '-0.1651318715277657',
                    '-0.12870823099214784', '-0.13363793930310397',
                    '-0.008813795170489691', '-0.23178082497304853',
                    '-0.1685051541259634', '-0.16694327454300806',
                    '-0.16625458887371292', '-0.13105868786610897',
                    '-0.2214108090318449', '-0.11927768661005206',
                    '-0.1171656198538702', '-0.07475749610796162',
                    '0.0003337427308395813', '-0.07224521085170249',
                    '-0.07800439238823376', '0.012915109152503823',
                    '0.030252141210866612', '-0.05981464411327597',
                    '-0.037901217348756344', '0.0014893663775620292',
                    '0.016465084782816275', '0.02503598503612048',
                    '-0.03532295443699979', '-0.02267315334383896',
                    '0.0693649479788957', '0.06280121316988707',
                    '0.06117281985164136', '-0.08156602797988333',
                    '-0.0009705549260509705', '0.058975976883114734',
                    '0.059692259998378794', '0.07320644000099352',
                    '0.08770955952132264', '0.05850645803611543',
                    '0.08552508570978468', '0.07925781784681851',
                    '0.05817021885796436', '0.04566551404891639',
                    '0.07942795686290693', '0.01701979489028771',
                    '0.02168620676493327', '0.04246348449671', '0.08178680998042287',
                    '0.03758735652893053', '0.01867956617413924',
                    '-0.029807006549452952', '-0.01684177896651684',
                    '0.06820566851141863', '-0.02139762161236225',
                    '0.0030134061041625637', '0.07750793700438718',
                    '0.08151577344672645', '0.00501243423459069',
                    '0.020740110978734405', '0.03933996352878666',
                    '0.053897451516615624', '-0.02271581740111228',
                    '0.020015079549086212', '0.02728392532904167',
                    '0.009379376409652584', '0.03909212002534668',
                    '0.06064900194150369', '0.07284584152106144',
                    '0.048797985519369425', '-0.013690161619508256',
                    '0.03326976668301179', '0.05762805567798501',
                    '0.049165372493989445', '0.050535792058636564',
                    '-0.007218230681416027', '0.05666992958617867',
                    '0.05251979007688723', '0.10164459592025699',
                    '0.0037418330892797225', '0.050019711207615614',
                    '0.06292777102437164', '0.030882178880520805',
                    '0.03771216408532646', '-0.027714559174038478',
                    '-0.0863555956818911', '-0.03279921849650358',
                    '0.08020448180350759', '0.04693493856805908',
                    '0.005241804581374521', '-0.04947309103917674',
                    '-0.14602384885038094', '-0.022335104493252544',
                    '0.05436330489444474', '-0.004061570482605581',
                    '-0.09241778286608254', '-0.13392300714427158',
                    '-0.022357055760684585', '0.04891526555842707',
                    '-0.017383422642642032', '-0.051280080836633934',
                    '-0.10211678569553467', '4.4127809815108776e-05'],
                ['profession', '-0.022951401855248355', '0.10406421380057129',
                    '0.09857763071726477', '0.11594541411262982',
                    '0.3615536263782011', '0.1088667918632873',
                    '-0.039535559731055214', '0.0375548579582064',
                    '0.12403080428515245', '0.16398684553056708',
                    '0.11899254680774962', '0.06972671367856909',
                    '0.0854299918699899', '0.01659047764715743',
                    '0.03682114320295515', '0.09377045690714214',
                    '0.11369491481257477', '0.13990755229854568',
                    '0.13733786032490325', '-0.04270501488475492',
                    '-0.07345017037292284', '-0.0058379366636703844',
                    '0.10385188027472347', '0.0797933669602211',
                    '0.05375978737660703', '-0.11986792628941306',
                    '-0.1332561675409415', '0.0021900447873631768',
                    '-0.04739221954049894', '0.01565018642918775',
                    '0.07682326086464558', '-0.011241949494634973',
                    '0.003444277108416771', '-0.06460376543878243',
                    '0.010571748775657641', '-0.04557148892654628',
                    '0.0720789697393367', '-0.00368215910733094',
                    '-0.03031879751194222', '-0.00011136759349544834',
                    '0.012880154214046757', '-0.0017756448824223225',
                    '0.0024675687802547808', '0.06216685903390806',
                    '0.08319385002105151', '0.011630312130153697',
                    '0.04838787303374881', '0.004982412519076274',
                    '0.035174877349236744', '0.03333242756673771',
                    '0.07570630170747084', '0.07013619298932294',
                    '0.01736700968411825', '0.018436487902771304',
                    '0.07756646918862187', '0.07162560921465122',
                    '0.04872595325275908', '0.01026034208414156',
                    '0.024404931351097225', '0.02066489130336302',
                    '0.013551764679123168', '-0.05162907842355979',
                    '-0.10461582263638763', '-0.011464374819428691',
                    '-0.02126559617385171', '-0.02214531046857926',
                    '0.021115236639861645', '-0.03335409081309626',
                    '-0.060771218237648084', '-0.058405260660662706',
                    '-0.08103462030294178', '-0.04732409296914225',
                    '0.014169180675262905', '-0.06935466807655727',
                    '-0.07467782220829894', '-0.07286544272284146',
                    '-0.01488021147303531', '0.00890528544551189',
                    '-0.06871977180401917', '-0.10683655694610772',
                    '-0.02105289054945325', '-0.18540272086639953',
                    '-0.007172625152303214', '-0.10925012255898986',
                    '-0.0630957964125411', '-0.005941659535853794',
                    '-0.01857888364143384', '0.02375092919812205',
                    '0.1021353034214249', '-0.11440264209199813',
                    '0.011821836397597152', '-0.02236555731603007',
                    '-0.021366995458802773', '0.07768704891643857',
                    '-0.04542534333841214', '-0.42216732680471813',
                    '-0.04096677886256983', '0.07198818263981216',
                    '0.07844059325101416', '0.20559748221848673',
                    '-0.4554168466513237', '-0.03101684851735137',
                    '0.05534177917640404', '0.08033037062731108',
                    '-7.847987581044436e-05'],
                ['point', '0.03241322421324666', '0.05575495213879855',
                    '0.020464045175328183', '-0.017382804623180648',
                    '-0.07279984871212314', '-0.09786065856563636',
                    '0.006895044459619526', '-0.036460456013583054',
                    '-0.08565363624626282', '-0.14336495474620198',
                    '-0.1583901189739474', '-0.03976822092606502',
                    '-0.11153754363493062', '-0.13568688689561342',
                    '-0.12192179912769224', '-0.12980703879090533',
                    '-0.15154073352091235', '-0.1546914689753648',
                    '-0.11725843374257078', '-0.13065575607432667',
                    '-0.1463472771422476', '-0.11998366065749855',
                    '-0.12915799268829076', '-0.08592585731285274',
                    '-0.044840890991704296', '-0.07474554260839272',
                    '-0.09019622604131744', '-0.07427099119014025',
                    '-0.08122465479091784', '-0.07243986138808922',
                    '0.015031469687903587', '0.04486937646512068',
                    '-0.04639576433067594', '-0.03051333904090353',
                    '-0.03247821786488486', '0.009977144886050948',
                    '-0.04266527728851188', '0.0207312323131561',
                    '-0.0007693964792253594', '-0.018779202340519996',
                    '0.0010205084442771462', '0.010465017896441275',
                    '-0.004967046717189283', '-0.01686925963135988',
                    '-0.03613204242007689', '0.0011059592857184386',
                    '0.018559447536561136', '0.05341660220298783',
                    '0.02791746180751542', '0.020058348718490215',
                    '0.016012134168527314', '0.05426348958593308',
                    '0.024845882009266518', '0.04249498764107662',
                    '0.024991018706164825', '0.03959974120361631',
                    '0.023342909286375946', '0.03394426003980411',
                    '0.03867225901035609', '0.049714536431942125',
                    '0.026418378255933406', '0.020814270630855836',
                    '0.042372429378587984', '0.03108363989149343',
                    '0.016485633287849466', '0.03825924865237518',
                    '0.014964302562697207', '0.011336363367840385',
                    '0.01665338810206396', '0.041799784379229266',
                    '0.07975355237964077', '0.07767438943120586',
                    '0.031747865910212614', '-0.0082268826560839',
                    '0.008976331144997463', '0.03077170763869086',
                    '0.10324284460958899', '0.0962594215625161',
                    '0.03223525126755156', '0.03285296205589394',
                    '0.06946152766630465', '0.07261884233643101',
                    '0.06304383716599482', '0.06986385760175373',
                    '0.09501046983718131', '0.09404111555353217',
                    '0.07314362445748723', '0.029199353137389972',
                    '-0.040071288848356035', '0.11507180987223842',
                    '0.08726295748646817', '0.06910615321396679',
                    '0.01677695999091816', '0.011471161698313137',
                    '0.048760245779238764', '0.11330261305833911',
                    '0.08788671746921117', '0.04920263262788627',
                    '0.03281277887441225', '0.032743323383441214',
                    '0.024394403688204225', '0.0966399433601185',
                    '0.07987297656805725', '0.0562736942387293',
                    '6.244005635380745e-05']], dtype='<U32')

    return mse, w_e


@pytest.fixture
def handler_result():
    mse = np.array([8.47669858e-03, 5.45198031e-03, 5.19718969e-03, 6.71158249e-03,
                    1.21059941e-02, 5.59158250e-03, 8.87761556e-03, 8.10294011e-03,
                    1.00736316e-02, 1.29504441e-02, 9.56570233e-03, 5.02806039e-03,
                    9.45694310e-03, 7.36669354e-03, 1.13834969e-02, 1.36657364e-02,
                    7.99697610e-03, 1.27024008e-02, 1.23572056e-02, 7.71637927e-03,
                    1.00836441e-02, 1.00104660e-02, 9.71180728e-03, 5.90724333e-03,
                    3.97032879e-03, 1.12543064e-02, 1.44318490e-02, 8.83009560e-03,
                    8.72971649e-03, 6.36282818e-03, 1.74283579e-03, 1.24449214e-02,
                    1.28706214e-02, 1.13762382e-02, 9.25411723e-03, 6.03712267e-03,
                    9.83212593e-03, 1.06561726e-02, 9.52161881e-03, 9.65108260e-03,
                    1.10481896e-02, 1.10937551e-02, 1.00812651e-02, 1.00823070e-02,
                    8.05083033e-03, 5.92959444e-03, 9.29222897e-03, 1.16403595e-02,
                    1.13164672e-02, 8.65862221e-03, 8.84706370e-03, 1.14166270e-02,
                    1.08622952e-02, 1.10816858e-02, 1.10855716e-02, 1.17113086e-02,
                    7.02337211e-03, 7.90226286e-03, 1.20100926e-02, 1.21159354e-02,
                    6.10296691e-03, 7.55960728e-03, 1.14004606e-02, 1.37738890e-02,
                    7.74841491e-03, 6.71823237e-03, 3.84956243e-03, 5.48109592e-03,
                    8.69657127e-03, 9.52906301e-03, 1.53355695e-02, 1.21597966e-02,
                    6.42153389e-03, 6.72943167e-03, 8.05751069e-03, 1.13853769e-02,
                    1.33148540e-02, 1.14060761e-02, 6.31835453e-03, 7.46944003e-03,
                    1.17696204e-02, 1.03910968e-02, 7.33540766e-03, 9.70475636e-03,
                    7.80773185e-03, 8.11393248e-03, 8.44550475e-03, 7.10438611e-03,
                    5.44693395e-03, 9.63815399e-03, 6.90765646e-03, 6.92393538e-03,
                    6.91300403e-03, 9.19309860e-03, 4.93347007e-03, 1.07801766e-02,
                    7.01782935e-03, 7.32518791e-03, 5.01717784e-03, 4.38024296e-03,
                    9.67490906e-03, 6.30011292e-03, 6.07105052e-03, 6.32416757e-03,
                    2.22325209e-11])

    w_e = np.array([['word', 'e1', 'e2', 'e3', 'e4', 'e5', 'e6', 'e7', 'e8', 'e9',
        'e10', 'e11', 'e12', 'e13', 'e14', 'e15', 'e16', 'e17', 'e18',
        'e19', 'e20', 'e21', 'e22', 'e23', 'e24', 'e25', 'e26', 'e27',
        'e28', 'e29', 'e30', 'e31', 'e32', 'e33', 'e34', 'e35', 'e36',
        'e37', 'e38', 'e39', 'e40', 'e41', 'e42', 'e43', 'e44', 'e45',
        'e46', 'e47', 'e48', 'e49', 'e50', 'e51', 'e52', 'e53', 'e54',
        'e55', 'e56', 'e57', 'e58', 'e59', 'e60', 'e61', 'e62', 'e63',
        'e64', 'e65', 'e66', 'e67', 'e68', 'e69', 'e70', 'e71', 'e72',
        'e73', 'e74', 'e75', 'e76', 'e77', 'e78', 'e79', 'e80', 'e81',
        'e82', 'e83', 'e84', 'e85', 'e86', 'e87', 'e88', 'e89', 'e90',
        'e91', 'e92', 'e93', 'e94', 'e95', 'e96', 'e97', 'e98', 'e99',
        'e100', 'e101', 'e102', 'e103', 'e104', 'e105'],
       ['penfield', '-0.09899836736423834', '-0.18085499986698275',
        '-0.17633530384054869', '-0.16290531355010202',
        '-0.04805938517620445', '0.0026393154687271436',
        '-0.20770609186684863', '-0.13324993842754357',
        '-0.1956868517318871', '-0.06848455230546074',
        '0.07463886716571122', '-0.14422323961110617',
        '-0.16702349525313603', '-0.09612725532796462',
        '-0.027112445050272882', '0.007699121392051644',
        '-0.016146526538185935', '0.012708596375161973',
        '0.02874179318188541', '-0.02703531118257768',
        '0.06654061058718297', '-0.033453554481709724',
        '0.006014686641291123', '0.009555733966830404',
        '0.03946150200854781', '-0.006403802992010155',
        '-0.027522333279177413', '0.056532097763050015',
        '0.048983448732759505', '0.014695468361531128',
        '-0.04617185506562971', '-0.03731819774400574',
        '0.054319298526819826', '-0.008701327773010692',
        '-0.003090499136330749', '-0.004923087398731707',
        '-0.20307902025612645', '0.01475390472867022',
        '0.05001088561221123', '-0.018981819156859925',
        '0.02456037186577109', '-0.0027641743334330116',
        '0.02476564298894035', '-0.035062878803808595',
        '0.0381368342263112', '0.03535582649018393',
        '-0.047921959966791716', '-0.024897362115728017',
        '-0.0032857218850508296', '-0.032939888748443336',
        '0.033265159428464974', '0.08773227866306621',
        '-0.04125316766528342', '-0.06580872500866347',
        '0.018529902600629033', '0.018619675313768624',
        '-0.021398934533075398', '-0.0005433602558513329',
        '0.024731961387894796', '0.033506642347815974',
        '-0.018647596602492267', '-0.00031431296303091605',
        '0.014277448539052995', '0.06955099923654928',
        '-0.027578855391881818', '0.052619480537309804',
        '-0.017409187928631054', '-0.018308004969612823',
        '-0.012179693865422447', '0.010269457209571675',
        '-0.011102071179270812', '-0.0483289927336662',
        '-0.04306967424645497', '-0.017008926256369072',
        '0.02061262990624363', '-0.025226488933762337',
        '-0.08574531314464401', '-0.14310729458654586',
        '0.014217996074791073', '0.014462776614548256',
        '-0.06755627642246342', '-0.11019153696113598',
        '-0.011443667200822738', '-0.07180758849966473',
        '-0.029291839822831178', '-0.11473345462926601',
        '-0.13555609371676508', '-0.11248631653429958',
        '-0.15265571599214706', '-0.11282764405991436',
        '-0.06829598426726768', '-0.13681368622385348',
        '-0.11040064795825633', '-0.17957599599910481',
        '0.08318872010755751', '-0.03935707951388723',
        '-0.10667335153368235', '-0.17401230395357936',
        '-0.22633200296564643', '0.0798723368712031',
        '0.1369077060854147', '-0.10148170723469357',
        '-0.21595981843190482', '-0.22294180222472476',
        '-4.348461516201496e-06'],
       ['raised', '0.02608757947160567', '-0.04484956180799282',
        '-0.034913008756021824', '-0.054875359773634724',
        '-0.051936487988265945', '-0.03210030889809429',
        '-0.01852131011762237', '-0.0400484184395668',
        '-0.07184348524233197', '-0.017915400232255685',
        '-0.0011535870278935878', '-0.053084850972584974',
        '-0.0831834235595133', '-0.12818552899648317',
        '-0.035171761430160986', '0.003514005767395023',
        '-0.10940665231666485', '-0.09541807224725268',
        '0.03458676532798399', '-0.013435764192072153',
        '0.013658852127569454', '0.0057259847522235785',
        '0.031228377638931937', '0.004175941345442191',
        '0.013295745732707975', '0.01762708614525965',
        '0.08073778295689515', '0.05069584071392719',
        '0.06166478482619253', '0.02741951999924741',
        '0.008167612569418836', '0.044881519754032206',
        '0.05693497208357823', '0.059853578815008524',
        '0.08928009932854264', '0.07073145230222577',
        '0.11152722115846414', '0.06915596518409561',
        '0.04725095993158357', '0.06319265314459532',
        '0.0590826035441383', '0.03675476604777528',
        '0.04360454155217364', '0.0986130093079911',
        '0.10604088426756608', '0.07672179161156434',
        '0.02659154897509386', '0.012403346426987039',
        '0.04213682845955635', '0.07766580599893158',
        '0.05799819777608595', '0.06659925752443097',
        '0.02289598602228149', '0.019635418347792144',
        '0.051208056641777744', '0.05519356968586753',
        '0.024355324859958616', '0.03468048996201778',
        '0.04041545361282428', '0.06052791854062456',
        '0.03788430918154945', '0.02827418244189861',
        '0.05779903151772625', '0.11163895015015701',
        '0.08177461689172749', '0.08548219414999614',
        '0.014221674086680514', '0.02859018439923411',
        '0.052841294942760464', '0.0827009866743521',
        '0.11088411094871553', '0.0914033956385435',
        '0.01766816879597355', '0.06121053220044781',
        '0.07471506059507593', '0.07581939604537213',
        '0.07000791241753634', '0.02414439914452815',
        '0.049072389556871765', '0.054477399225101086',
        '0.05503421780959772', '0.04594222444918489',
        '0.047045529147947796', '0.028613962737831566',
        '0.017542313096993722', '0.02054777342905456',
        '-0.01635089329941891', '-0.03805449786791293',
        '-0.07755873218936848', '0.0465824213143784',
        '0.005286477855642846', '-0.012881959650066444',
        '-0.03857556657076283', '-0.07695299232343178',
        '0.08377306443147747', '0.0749550898421032',
        '-0.01445229936777831', '-0.018160810514706527',
        '-0.017602721417109946', '0.062340079852897023',
        '0.08793017017226512', '0.05480090636997942',
        '-0.03424309607093179', '-0.020349327807942852',
        '-4.2643805500119925e-06'],
       ['described', '-0.22131059945705023', '-0.1310059462392606',
        '-0.11626031992263641', '-0.183787823878432',
        '-0.19069732799803635', '-0.11627736249630471',
        '-0.12705870814137138', '-0.21370525689402917',
        '-0.20168626145501162', '-0.18055708550198152',
        '-0.054085182303060975', '-0.04878701106224714',
        '-0.17255648192774448', '-0.172703872952078',
        '-0.1417562052620518', '-0.18419220821187549',
        '-0.051621939342747836', '-0.14372754778476604',
        '-0.17400214482267234', '-0.08638298501355379',
        '-0.1423203862363887', '-0.12769440356375866',
        '-0.0966347455887972', '0.02470181268967253',
        '0.04996249469459069', '-0.1086158800342934',
        '-0.1349452601384628', '-0.02296394266967372',
        '0.027078588387414837', '0.129850984632235',
        '-0.06207053140784208', '-0.11461261002877882',
        '-0.030049402262742775', '-0.05028430548327101',
        '0.06044958674024692', '-0.1474662351774172',
        '-0.11714288395474465', '-0.08899085347870217',
        '0.009353481933206842', '0.025245988294374966',
        '0.027732856216795443', '0.021301513981355602',
        '0.11187997864128763', '0.1321201466870563',
        '0.12618771511129667', '0.08405425642005127',
        '-0.06516731449596941', '0.01765846828411244',
        '0.07050864801476253', '0.0904671316103135',
        '0.18208137635531274', '0.23555924000791195',
        '0.006542654818503246', '0.051632740089958884',
        '0.10343752715330079', '0.2128428997403593',
        '0.05483355499419562', '0.11144621937443111',
        '0.18923184672597282', '0.19599173929045777',
        '0.07307879459120747', '0.14194917172810817',
        '0.15488412183899614', '0.1573306671995679',
        '0.10527623287875754', '0.029807169853732773',
        '-0.08178596171239982', '0.08221507152738039',
        '0.08120081777393051', '0.06376698716626894',
        '0.12231350786660866', '-0.00015550664318475516',
        '-0.10993351221305409', '0.038255641104042115',
        '0.03421087524719513', '0.02891267355002458',
        '-0.0040413388836699204', '-0.06678705390549539',
        '-0.010007987645995864', '-0.019566921349193522',
        '-0.040955143817561046', '-0.0820898000977398',
        '-0.03463254106742053', '0.00954978627331815',
        '-0.07399285170545439', '-0.09994730401570923',
        '-0.15934351415855053', '-0.16433597259610844',
        '-0.1911596751459507', '-0.10403723073345711',
        '-0.11236351307365877', '-0.15176439268690584',
        '-0.17519181613797075', '-0.34028590904620865',
        '-0.07268941697826592', '-0.16278393303659422',
        '-0.16830168884309543', '-0.20124197962101809',
        '-0.19650479107822694', '-0.07978865208312408',
        '-0.15700968548918326', '-0.1527723360155324',
        '-0.1485248719636632', '-0.17650530684358828',
        '2.5831686798483133e-06'],
       ['treasury', '-0.11580443369432392', '-0.05880364671829347',
        '-0.0823802776956758', '-0.12738688979270874',
        '-0.22583424867816781', '-0.13382765191442414',
        '-0.031970486232035744', '-0.10581739253568867',
        '-0.17048931097115477', '-0.25372183658795633',
        '-0.25092134119666537', '-0.01647256487174842',
        '-0.14684692809494065', '-0.12901141998563298',
        '-0.22929778609009288', '-0.2615540131785073',
        '-0.13618420939825693', '-0.24804848358922726',
        '-0.19115570817454058', '-0.11659069988332477',
        '-0.17546256125853832', '-0.19541715218962896',
        '-0.08330374400082718', '-0.023589127194347026',
        '-0.007399403035051821', '-0.10030898786496878',
        '-0.13144416274428916', '-0.049279588847673694',
        '0.02300551857333677', '-0.013347136794262249',
        '-0.07449891837065956', '-0.055964982299837096',
        '-0.036794690211384595', '-0.02575004928033392',
        '0.056198199503372126', '-0.0257912870873081',
        '0.025888641949009306', '-0.004371419378551011',
        '0.01213934542899009', '-0.0103775333047042',
        '0.01073688040705012', '0.07320737591028081',
        '0.05748097455507872', '0.02329914578004455',
        '0.06913133476025635', '0.05430854689140863',
        '0.09264374726291269', '0.05882348627270284',
        '0.030044681475766777', '0.0786408423965469',
        '0.10815246506583087', '0.0693424865702047',
        '0.08441260658896044', '0.09835783419082988',
        '0.0723990229892163', '0.0639528363634495',
        '0.06039261590561218', '0.06997855541116327',
        '0.09114942987322039', '0.11659259152174073',
        '0.04799044051267093', '0.04673255271780774',
        '0.08255473881752973', '0.05857090586544922',
        '0.06034127280679613', '0.03517637479639657',
        '0.06468341532634869', '0.054677173641168864',
        '0.07826534496328508', '0.08974140724409874',
        '0.08319214325240665', '0.03627019863023351',
        '0.025244776437640448', '0.04054469320366766',
        '0.08069292307498743', '0.09384326655257846',
        '0.12060862024796337', '0.07372614219637741',
        '0.05349661727129518', '0.09234550540105857',
        '0.10192157284122816', '0.09673254018375521',
        '0.10284859073840935', '0.11743774748155011',
        '0.10962785892031202', '0.027929212892157163',
        '0.006975759835246453', '0.01425090594597428',
        '-0.09109751277768474', '0.10818504860023426',
        '0.03134644167470646', '-0.026852187365243585',
        '-0.044518314740716325', '-0.14667749386276657',
        '-0.03693622405216307', '0.028315173383868797',
        '-0.033526416738341946', '-0.09402540342913618',
        '-0.0830587498919253', '-0.019420919752937915',
        '-0.21021910153320822', '-0.008910488076818213',
        '-0.05585942824611512', '-0.05974526930071328',
        '-1.0254807421006262e-06'],
       ['cabinet', '0.06610827813738518', '0.05720143281343271',
        '0.0801422344084326', '0.12514990866889664',
        '0.01698119113074692', '0.05348810599150322',
        '0.04386131736379173', '0.14705488145780266',
        '0.12587182006036224', '-0.010514783449989795',
        '-0.07564343779851601', '0.1029637142276828',
        '0.0956009779432937', '0.19623804777266218',
        '0.023785546251852363', '0.03252101656113193',
        '0.19007277641090614', '0.10632531122604638',
        '0.034876799725530594', '0.10238639195130306',
        '0.12134821849847222', '0.060289844328921816',
        '0.02934827680298946', '0.03847810057520762',
        '-0.0529290189471992', '0.13897345650545678',
        '0.11572547153037127', '0.06027972685188787',
        '-0.02960540183815774', '-0.04702885017635383',
        '0.06370219177173886', '0.09987368499259341',
        '0.08212329538816077', '0.015339372982116295',
        '-0.011839550237237373', '0.19404801269610217',
        '0.29536392747135753', '0.08382421291404185',
        '0.022346418341891106', '0.019870689430545707',
        '0.08807885054213316', '0.08470856168006768',
        '-0.005098730093584525', '-0.028744977813414008',
        '-0.07925332903341131', '-0.06928179330523365',
        '0.1916574097545538', '0.10093240031472639',
        '0.04552989751277581', '-0.0031314057166287323',
        '-0.00190408571856171', '0.01603003933606928',
        '0.15143209770666088', '0.13653702556460545',
        '0.05485664730215545', '0.05332336001931404',
        '0.07981680546611147', '0.0934379848714737',
        '0.09786054561393531', '0.027498778474396413',
        '0.09568296134108811', '0.08843814677344608',
        '0.057622632516012295', '-0.013853107014461019',
        '-0.020534205342361167', '-0.057202084397666386',
        '-0.02579215790229744', '0.07658878932640378',
        '0.09839241590305925', '0.08617509066341622',
        '0.0342110112007753', '-0.13118969605664216',
        '-0.05755246848908796', '0.0716506368684362',
        '0.07098685946290573', '0.036759317512810585',
        '-0.02467476878351671', '-0.0751384602571945',
        '0.05023527683432283', '0.035948194273155765',
        '-0.045725861857032035', '-0.07224161898818443',
        '0.020321226613286225', '-0.0171252368883969',
        '-0.004586091005799209', '-0.07708803045041662',
        '-0.05465275968368466', '0.00133354310343331',
        '0.033644178404500624', '-0.03603796649508456',
        '-0.06849038218627018', '-0.05122778854663251',
        '-0.029085442667583672', '0.07264708685090415',
        '0.025013163945009742', '-0.019223014812641548',
        '-0.022364873280753095', '-0.00417461155725074',
        '0.07059556330512717', '0.08110689565300522',
        '0.0430325427141488', '0.01814183918172141',
        '0.015736262663096356', '0.060875004879388905',
        '1.3078533811494708e-07'],
       ['boston-based', '-0.04658983327133637', '-0.05371676569091888',
        '-0.03830830108916555', '-0.022115806847256503',
        '-0.06039230148557051', '-0.07048837848061684',
        '-0.07154518043809016', '0.0014106937542368025',
        '0.03163316039455211', '0.022978496060906073',
        '-0.09188990994984758', '0.009753680278978494',
        '0.004532710814419527', '-0.023585414491142376',
        '0.019505429993011858', '0.03292656964010643',
        '-0.020431426228872507', '0.008011485568374277',
        '-0.017558594485996948', '-0.007522690572976165',
        '0.023080353893830563', '0.062157208713492174',
        '0.041318304412469975', '0.017582632902518602',
        '0.011309658738881123', '-9.302110204234548e-05',
        '0.05201514863884371', '0.016268691993636453',
        '0.011820427213206974', '0.03685646407172527',
        '0.019726030366302938', '0.030858663601236125',
        '0.04896019098248483', '-0.011840927816204494',
        '-0.003769491606083142', '0.05746969292595516',
        '-0.0019544966323938873', '0.03349134125072872',
        '0.026035659757412066', '0.041521334106908614',
        '0.03355954733016753', '0.046287905463650136',
        '0.02867846780420913', '0.0032899038544605963',
        '0.031440791959503445', '0.026199067471996795',
        '0.009340431270162375', '0.06659230074944966',
        '0.07757976719928306', '0.0418539270688536',
        '0.021870520543965988', '0.018092165258984716',
        '0.04793659236910086', '0.05436259347871575',
        '0.07065730080847554', '0.0028334640016697277',
        '0.01676090096474042', '0.03895002110450885',
        '0.012709500936582963', '-0.010065213999931322',
        '0.02857717402650528', '0.036601684539762314',
        '0.0023625662274137094', '-0.0028609324808280823',
        '-0.010802696288777835', '0.016765992959407394',
        '0.02419531428792482', '0.025336267491209763',
        '0.03407455936114068', '-0.0149002001884046',
        '-0.01900046281834583', '-0.0007133097880442918',
        '0.0050339521863941306', '0.035219986645717016',
        '0.04527982098958061', '0.03115590644249644',
        '0.00141784383393323', '0.004813048709007617',
        '0.037321384363338095', '0.03289986076699691',
        '0.03492367844031641', '-0.005194166479755513',
        '0.025830752243599597', '0.030632056059839374',
        '0.003865369743875524', '-0.0042731892269055605',
        '-0.009561770161915895', '-0.018709204212815134',
        '-0.020254435636007706', '0.006941259681779999',
        '-0.0024806329352183853', '0.0064998049416192805',
        '-0.01704424242541447', '-0.07559175974919125',
        '0.039924338636681656', '0.011966989538741202',
        '-0.019654735786443556', '-0.03861649231355463',
        '-0.020683518936119527', '0.04001985202291325',
        '-0.017098388226082117', '-0.002092476666536669',
        '-0.059292893841943084', '-0.05302982752866808',
        '-9.134237188845873e-07'],
       ['norwich', '0.01993312360215882', '0.0036236325244917156',
        '-0.005413868556678136', '0.028581583605021943',
        '-0.05261031941302663', '-0.07830583209755587',
        '-0.06023097018792378', '-0.026486627854438782',
        '-0.023590415456751224', '-0.05982813871490378',
        '-0.07156919623338592', '-0.00811304783275979',
        '-0.011624664137700691', '0.007951219607544968',
        '-0.021641783803717618', '-0.05472895304226516',
        '0.07499120983931429', '0.07824003524427103',
        '0.025601835293281083', '0.045259638508487965',
        '0.1336616695175007', '0.007822003179534964',
        '0.011723619350889725', '-0.018799888546480403',
        '-0.06296719677117302', '0.03871554491485352',
        '0.002926379094754683', '-0.013695617419422268',
        '0.009629223379595486', '-0.025376214565759336',
        '0.012648505080736672', '0.029439279078459113',
        '0.013405069543292236', '0.016272122906901165',
        '0.0010832106183380485', '0.03175675209743811',
        '0.06255481086051451', '0.04781719536064466',
        '0.026953793948232274', '-0.021892694487856468',
        '-0.003091954887541326', '0.01940314414300237',
        '-0.012239734298446714', '-0.036843923606028894',
        '-0.05515330990037598', '-0.025201376711320167',
        '0.006825288621493897', '-0.0004138044419429443',
        '-0.0075019274307822625', '-0.023737151292586578',
        '-0.04972953138762326', '-0.08307134155076956',
        '0.02078531611339096', '-0.028764990027471682',
        '-0.03209308057155991', '-0.038641952668404755',
        '0.005794706061830246', '-0.03092476496650065',
        '-0.06607186529584563', '-0.1118364126801542',
        '-0.028991426263278663', '-0.042713963015196754',
        '-0.07482703855770184', '-0.11194587266672873',
        '-0.06673937906348126', '0.0017415990241209656',
        '0.03737591463310175', '-0.027464992951585387',
        '-0.043298294125506565', '-0.06372782371578162',
        '-0.0406650516116292', '0.00939248762231959',
        '0.03149327185286083', '-0.03018045596821317',
        '-0.026650607981879015', '0.023168947967118547',
        '0.04836656486370294', '0.0572081467808605',
        '0.01203987215545288', '0.031039456480351446',
        '0.07296740097032506', '0.06338161671415377',
        '0.01145051131708108', '0.06394903611942498',
        '0.06897790804628279', '0.04831002773570864',
        '0.03511497801827729', '0.020146569880527543',
        '0.03609083184386752', '0.09451921519620765',
        '0.061619899448659754', '0.009965656884827201',
        '-0.02481158388759991', '0.02099185316083607',
        '0.010556414065416075', '0.04973522576493783',
        '0.03080454268220717', '0.017000913647889693',
        '0.024546289719520886', '0.03254665584459149',
        '0.0727443855698584', '0.032034670833351875',
        '-0.017407061117575562', '-0.009965606952088035',
        '4.7509820433333516e-07'],
       ['plotted', '-0.07304528103992491', '-0.02758740085130218',
        '-0.1307923706112683', '-0.09493603904254827',
        '-0.08319162832997862', '0.012824588865442854',
        '-0.14167762722765426', '-0.16163441998395772',
        '-0.12312303735811464', '-0.12765053352612643',
        '-0.002865400633517645', '-0.22369062693303998',
        '-0.16038789557722682', '-0.16338338713379785',
        '-0.16334319999965896', '-0.12814646452702816',
        '-0.21787410782945232', '-0.11685714198572345',
        '-0.11333035898579769', '-0.0719613230122585',
        '0.002421574228031964', '-0.07102868005183677',
        '-0.07322183490074596', '0.015306924338050698',
        '0.03151552126152579', '-0.05336911703655478',
        '-0.03839188278454736', '0.0022416962039170096',
        '0.01954145931360851', '0.026379294915423457',
        '-0.036195596238833894', '-0.019067847195309906',
        '0.071085793678206', '0.06406179180224181',
        '0.061071849583391846', '-0.08272223887923635',
        '-0.0031606083890331482', '0.06151352542513744',
        '0.05926817295080189', '0.07240773776100329',
        '0.08928270491087953', '0.057964294187238474',
        '0.08509831645319288', '0.0780918913903671',
        '0.05623306790276417', '0.04353828388152747',
        '0.07598787478969526', '0.011567460009458852',
        '0.018734465546366375', '0.04050302812540263',
        '0.08339732748225392', '0.03464598651855455',
        '0.014167196541418292', '-0.034326290320967845',
        '-0.020696530553430903', '0.06291128593924455',
        '-0.02335745213489948', '-0.0021100303467956882',
        '0.0725388765833972', '0.07683406701819862',
        '0.003462832679720085', '0.01826902161563626',
        '0.03141701612201786', '0.04843450700901675',
        '-0.027738760420979225', '0.014345247319471954',
        '0.024593908105683515', '0.008315493105056637',
        '0.03610121855516235', '0.054287815437139675',
        '0.06536963092688419', '0.04291631838222343',
        '-0.0182098030188918', '0.032117966527372144',
        '0.05467834101734048', '0.04451865399194477',
        '0.042504602616955656', '-0.013286102728840343',
        '0.05363444384170235', '0.05012192501989565',
        '0.0988725627056879', '-3.611791284124921e-05',
        '0.050334960173832655', '0.06513662975278045',
        '0.02859574470693682', '0.03328634039681938',
        '-0.031957694626308986', '-0.08956894168637719',
        '-0.031025265058698404', '0.0780834803214977',
        '0.045315897602025146', '0.00370287225791871',
        '-0.05169223156880931', '-0.1443709524461146',
        '-0.025302283314816265', '0.05369257382678727',
        '-0.005921652632111196', '-0.09422711166056191',
        '-0.1351087819474332', '-0.024999270058932876',
        '0.041801749227708074', '-0.02137919881909467',
        '-0.05338817791304995', '-0.10008951251743409',
        '8.77036654856056e-07'],
       ['profession', '-0.03213302054573908', '0.09959145145430359',
        '0.09421939869593299', '0.10647721629005902',
        '0.3616160920459257', '0.10397834672435602',
        '-0.04296482356124015', '0.035232601393112406',
        '0.12113705838595201', '0.16272471717744819',
        '0.11036721826694762', '0.06336797096464086',
        '0.07700439849383023', '0.012868316592546225',
        '0.03495343165891829', '0.09190685808359478',
        '0.11053533219767608', '0.1271754041280745',
        '0.13222181484989715', '-0.04082898849277189',
        '-0.07789912066360277', '-0.015746195578617894',
        '0.09758284255118221', '0.06815800385826187',
        '0.041944835479939546', '-0.1219907457130886',
        '-0.1402606371740439', '-0.011307784649892683',
        '-0.056448847290895665', '0.00520310152547071',
        '0.07110935100021992', '-0.02056587427452694',
        '-0.001735187708630348', '-0.07562004489778207',
        '-0.006506323056999219', '-0.05370153267158717',
        '0.05863114859904739', '-0.015023671310547493',
        '-0.043477476520426106', '-0.017342593560902675',
        '0.0018745141841395307', '-0.019783698185187215',
        '-0.012397293184924663', '0.05249251854738157',
        '0.07289500186889086', '-0.00942568428784557',
        '0.030145096639858426', '-0.018909751711270406',
        '0.012427003089288013', '0.011433383053035318',
        '0.05040591813966078', '0.05490604395863752',
        '-8.399919000645628e-06', '-0.0004406905277859474',
        '0.06155195283501469', '0.048677344138967626',
        '0.033268203885998826', '-0.008621545113352946',
        '0.0008621099437791102', '-0.0014272126547668629',
        '-0.004008121299575562', '-0.07050560120302451',
        '-0.1274343582027176', '-0.03664686039987303',
        '-0.04076957704886697', '-0.040134975738430945',
        '0.011738859772567334', '-0.04366074717372248',
        '-0.0798824343059159', '-0.08011339149714952',
        '-0.10574366618993519', '-0.067183406933986',
        '0.00028272895407149834', '-0.08047015946678554',
        '-0.09144875130642821', '-0.09480933973173733',
        '-0.03783992064051578', '-0.010465240629851269',
        '-0.08716144889752503', '-0.12059435204155144',
        '-0.030486696491988652', '-0.19808277457733703',
        '-0.021200906125737662', '-0.12061511899224792',
        '-0.07705380350978536', '-0.01687902244517081',
        '-0.029248383277130252', '0.01770883615956309',
        '0.09877258817713169', '-0.1257237993090239',
        '-0.0006264744544536294', '-0.03368018782445292',
        '-0.02571241248150785', '0.07358970642528867',
        '-0.055676597181719634', '-0.4291959065166322',
        '-0.04666888700732996', '0.06975080308887832',
        '0.06381295777204077', '0.19355078746293253',
        '-0.46845041551042405', '-0.033886841965608816',
        '0.04641225833099083', '0.07552540179338774',
        '-5.5805357987992465e-06']], dtype='<U32')
    
    return mse, w_e

def test_create_model(reference_model_config, set_seed):
    layers, activation, input_dim, output_dim = [100, 50], 'relu', 30, 15
    model = create_model(layers, activation, input_dim, output_dim)
    assert model.get_config() == reference_model_config


def test_model_cv(config_embedding, data, grid_search_reference, set_seed):
    _, X_train, y_train, _, _ = data
    grid_reduced, best_params = grid_search_reference
    # Test only first chunk
    X_train, y_train = X_train[0], y_train[0]
    _, grid_result = model_cv(create_model,
                              config_embedding,
                              X_train,
                              y_train)
    assert {k:v for k, v in grid_result.get_params().items() if not k in ['estimator', 'estimator__build_fn']} == grid_reduced
    assert grid_result.best_params_ == best_params
    

def test_model_predict(data, config_embedding, predict_result, set_seed):
    words_test, X_train, y_train, X_test, y_test = data
    words_test, X_train, y_train, X_test, y_test = words_test[0], X_train[0], y_train[0], X_test[0], y_test[0]
    mse_reference, w_e_reference = predict_result
    # Test only first chunk
    model = KerasRegressor(build_fn=create_model, verbose=0)
    model.set_params(**{'activation': 'relu',
                      'batch_size': 128,
                      'epochs': 100,
                      'input_dim': 50,
                      'layers': [5],
                      'output_dim': 105})
    model.fit(X_train, y_train)
    mse, w_e = model_predict(model, words_test, X_test, y_test)
    assert mse == pytest.approx(mse_reference)
    assert np.array_equal(w_e[:10], w_e_reference)
    

def test_model_handler(config_embedding, data, handler_result, grid_search_reference, set_seed):
    words_test, X_train, y_train, X_test, y_test = data
    words_test, X_train, y_train, X_test, y_test = [words_test[0]], [X_train[0]], [y_train[0]], [X_test[0]], [y_test[0]]
    mse_reference, w_e_reference = handler_result
    grid_reduced, best_params = grid_search_reference
    word_error, grids_result, mse_errors = model_handler(config_embedding, words_test, X_train, y_train, X_test, y_test)
    mse = mse_errors[0]
    grid_result = grids_result[0]
    w_e = word_error
    assert mse == pytest.approx(mse_reference)
    assert np.array_equal(w_e[:10], w_e_reference)
    assert {k:v for k, v in grid_result.get_params().items() if not k in ['estimator', 'estimator__build_fn']} == grid_reduced
    assert grid_result.best_params_ == best_params